import{jQuery as t}from"./src/jquery-3.5.1-min.js";import e from"./custom/Paths.js";import{timed as n,K as o}from"./custom/K-min.js";import{clamp as s}from"./src/clamp-min.js";const i=n();t((()=>{d(),t(window).scroll((function(){const e=t(".entry").last(),n=e.offset().top,o=e.offset().top+e.outerHeight(),s=t(window).scrollTop()+t(window).innerHeight(),r=t(window).scrollTop();s>n&&r<o&&i.run((()=>{d()}),500);const a=t(".query-box").hasClass("fixed"),l=t(window).scrollTop();l>0&&!a?t(".query-box, .terms-box, .filter-box, .list").addClass("fixed"):!l&&a&&t(".query-box, .terms-box, .filter-box, .list").removeClass("fixed")}));const e=()=>{const e=t("main .list");e.css("grid-template-columns",`repeat(${Math.floor(e.outerWidth(!0)/216)}, 1fr)`),t(".detail-wrap").css("max-height",t(".channel-title").outerHeight(!0)+t(".featured-video").outerHeight(!0)+30+"px")};e(),t(window).on("resize",e);const n=t(".category-box"),o=t(".scroller",n),s=t(".nav.next"),r=t(".nav.prev");let a=0;t(".link",o).each((function(){a+=parseInt(t(this).outerWidth()+10)})),o.width(a);const l={total:0,current:0,width:null,running:!1},c=()=>{const t=n.width(),e=o.width(),i=Math.abs(o.position().left),a=i+t<e,c=0!=i;l.total=Math.ceil(e/(t/2)),l.width=e/l.total,r[c?"addClass":"removeClass"]("active"),n[c?"addClass":"removeClass"]("prev"),s[a?"addClass":"removeClass"]("active"),n[a?"addClass":"removeClass"]("next"),l.running=!1};c(),s.on("click",(()=>{l.running||(l.running=!0,l.current!=l.total-1&&(l.current++,o.css({left:-l.current*l.width})),setTimeout((()=>{c()}),600))})),r.on("click",(()=>{l.running||(l.running=!0,0!=l.current&&(l.current--,o.css({left:-l.current*l.width})),setTimeout((()=>{c()}),600))})),t(".more-info").on("click",(function(){const e=t(this).hasClass("open"),n=t("+ .collapse",this);e?(n.removeClass("shadows"),setTimeout((()=>{n.slideUp(600)}),300)):n.slideDown(600,(()=>{n.addClass("shadows")})),t(this)[(e?"remove":"add")+"Class"]("open")})),t(".detail-head").on("click",(function(){if(t(document).width()>720)return;const e=t(this).parents(".detail-box"),n=e.hasClass("open");t(".collapse",e)["slide"+(n?"Up":"Down")](600),e[(n?"remove":"add")+"Class"]("open")}))}));let r=0,a=!1,l=null;const c=()=>Math.max(6,Math.round(t(".list").outerWidth(!0)/216)*Math.round(t(window).outerHeight(!0)/300));function d(){if(a)return void i.run((()=>{d()}),500);if(a=!0,r=t(".list .entry").length,!o.empty(l)&&r===l)return void(a=!1);!function(){const e=c(),n=r+1;for(let o=n;o<n+e;o++)t(".list").append(t(`<article index="${o}" class="entry only-loader">\n\t\t\t\t<div class="load-ripple">\n\t\t\t\t\t<div></div>\n\t\t\t\t\t<div></div>\n\t\t\t\t</div>\n\t\t\t</article>`))}();const n={post_type:["video"],tax_query:{0:{taxonomy:"video-channel",field:"term_id",terms:[t(".list").attr("term")]}},posts_per_page:c(),offset:r};t.ajax({url:e.ajax,data:{query:n,action:"custom_search",nonce:t(".content").data("nonce")}}).done((function(e){e=JSON.parse(e.replace(/0$/,""));const n=r+1;t.each(e.posts,((e,o)=>{t(`article[index=${n+e}]`).replaceWith(t(o).attr("index",n+e))})),t(".entry.only-loader").remove(),t(".entry .entry-title").clamp({clamp:2}),t(".entry").has(".entry-meta").each((function(){t(".detail-type",this).replaceWith(t(".entry-date",this)),t(".entry-meta",this).remove()})),function(e){const n=t(".results");if(!e)return l=null,void n.addClass("none");l=e,n.removeClass("none"),t(".got",n).text(t(".entry").length),t(".total",n).text(e)}(e.found),a=!1}))}t.fn.extend({clamp(e){this.each((function(){t(this).data("clamp")!==e&&(s(this,e),t(this).data("clamp",e))}))}});