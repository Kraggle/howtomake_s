import{jQuery as t}from"./src/jquery-3.5.1-min.js";import"./src/jQuery-UI/importer-min.js";import e from"./custom/Paths.js";import{timed as s,K as n}from"./custom/K-min.js";import{clamp as o}from"./src/clamp-min.js";const a=s();function i(){a.run((()=>{p(!0)}),500)}t((()=>{t(".dropdown").each((function(){const e=t(this);e.addClass("closed");const s=t("<div />",{class:"selected",html:t("select option:selected",e).html()}).appendTo(e);e.on("click",(function(s){s.stopPropagation(),s.preventDefault();const n=t(this).hasClass("closed");h(),n&&(e.removeClass("closed"),t(".items",e).slideDown(300))}));const n=t("<div />",{class:"items"}).appendTo(e),o=t("<div />",{class:"items-wrap"}).appendTo(n);t("select option",e).each((function(){t("<div />",{value:t(this).attr("value"),html:t(this).html()}).appendTo(o).on("click",(function(){s.html(t(this).html()),t("select",e).val(t(this).attr("value")).trigger("change")}))})),t(this).wrap('<div class="drop-wrap" />')})),t(document).on("click",h),t(".toggle").each((function(){const e=t(this),s=t("<div />",{class:"toggle-wrap"}).appendTo(e);t("label:not(.name)",this).each((function(){const n=t(this).attr("for");t("<div />",{class:"item"+(t(`#${n}`,e).is(":checked")?" show":""),for:n,html:t(this).html()}).appendTo(s)})),e.on("click",(function(){const s=t(".item:not(.show)",e).attr("for");t(`#${s}`,e).prop("checked",!0).trigger("change"),t(".show",e).removeClass("show"),t(`.item[for="${s}"]`,e).addClass("show")}))})),t(".check").each((function(){const e=t(this),s=t(this).data();t("<div />",{class:"marker"}).prependTo(t(this)).on("click",(function(){const e=t(this).siblings("input");!e.attr("disabled")&&"true"==e.attr("enabled")&&(e.prop("checked",!e.is(":checked")),e.trigger("change"))})),t("input",this).prependTo(t(this));const n=function(){let e=t(`input[disable="${s.disable}"]`);const n=t(this).is(":checked");e.attr("enabled",n).prop("checked",n),n&&(e=t(`input[disable*="${s.disable}"]`),e.prop("checked",n))};s.disable&&t("input",this).on("change",n),t("label",this).on("click",(s=>{"false"==t("input",e).attr("enabled")&&s.preventDefault()}))})),t(".checks").each((function(){const e=t(this),s=t("input",e),n=e.data(),o=()=>{const s=parseInt(n.atLeast),o=`.checks[data-name="${n.include}"][enabled="true"]`;let a=e;n.include&&t(o).length&&(a=a.add(t(o)));const i=t("input:checked",a);i.attr("disabled",i.length==s)};n.atLeast&&(o(),s.on("change",o)),t(".any",this).on("click",(function(){"true"===t(e).attr("enabled")&&t("input:not(:checked)",e).prop("checked",!0).trigger("change")}))})),p(),t("main input:not(#search), main select").on("change",i),t("#search").on("input",i),t(".search-box .clear").on("click",(function(){t("#search").val("").trigger("input")})),t(window).scroll((function(){const e=t(".entry").last(),s=e.offset().top,n=e.offset().top+e.outerHeight(),o=t(window).scrollTop()+t(window).innerHeight(),i=t(window).scrollTop();o>s&&i<n&&a.run((()=>{p()}),500);const c=t(".query-box").hasClass("fixed"),l=t(window).scrollTop();l>0&&!c?t(".query-box, .terms-box, .filter-box, .list").addClass("fixed"):!l&&c&&t(".query-box, .terms-box, .filter-box, .list").removeClass("fixed")}));const e=()=>{const e=t("main .list");e.css("grid-template-columns",`repeat(${Math.round(e.outerWidth(!0)/300)}, 1fr)`)};e(),t(window).on("resize",e),t(".mobile-button").on("click",(function(){const e=t(".mobile-wrap");e.hasClass("open")?e.removeClass("open"):e.addClass("open")})),t("#filters-btn").on("click",(()=>{const e=t(".filter-box");e.hasClass("closed")?e.add(".list, .terms-box").removeClass("closed"):e.add(".list, .terms-box").addClass("closed")}));const s=parseInt(t("#time_slider").attr("max"));t("#time_slider").slider({range:!0,min:0,max:s,step:1,values:[t("#time_from").val(),t("#time_to").val()],slide(e,n){n.values.sort(((t,e)=>t-e));const o=n.values[0],a=n.values[1],c=t(".duration .display"),l=a==s?'<span class="infinity"></span>':a;t("#time_from").val(o),t("#time_to").val(a),c.html(`${0==o&&a==s?"":o+" - "}${l} mins`),i()}}),t("input.slider-value").change((function(){const e=t(this);t("#slider").slider("values",e.data("index"),e.val())})),t(document).on("mousedown touchstart scroll",(e=>{let s=t(".filter-btn, .filter-box");s.is(e.target)||0!==s.has(e.target).length||t(s).add(".list, .terms-box").addClass("closed"),s=t(".my-menu"),s.is(e.target)||0!==s.has(e.target).length||t(s).remove()})),t(".cat-menu").on("click",(function(){const e=t(this),s=t(this).offset();t('<div class="my-menu">\n\t\t\t<label>Select</label>\n\t\t\t<div class="my-item only">Just me!</div>\n\t\t\t<div class="my-item not">All but me!</div>\n\t\t</div>').css({top:s.top+"px",left:s.left-90+"px"}).appendTo(".content"),t(".my-menu .my-item").on("click",(function(){const s=t('.cat-wrap input[enabled="true"]');t(this).hasClass("all")?s.prop("checked",!0).trigger("change"):t(this).hasClass("only")?(s.prop("checked",!1),t(`#${e.attr("slug")}`).prop("checked",!0).trigger("change")):t(this).hasClass("not")&&(s.prop("checked",!0),t(`#${e.attr("slug")}`).prop("checked",!1).trigger("change")),t(".my-menu").remove()}))}))}));let c=0,l=!1,r=null;const d=()=>Math.max(6,Math.round(t(".list").outerWidth(!0)/300)*Math.round(t(window).outerHeight(!0)/300));function p(s=!1){if(l)return void a.run((()=>{p(s)}),500);if(l=!0,s&&t(".list article.entry").remove(),c=t(".list .entry").length,!n.empty(r)&&c===r)return void(l=!1);!function(){const e=d(),s=c+1;for(let n=s;n<s+e;n++)t(".list").append(t(`<article index="${n}" class="entry only-loader">\n\t\t\t\t<div class="load-ripple">\n\t\t\t\t\t<div></div>\n\t\t\t\t\t<div></div>\n\t\t\t\t</div>\n\t\t\t</article>`))}();const o=parseInt(t("#time_to").val()),i={s:t("#search").val(),orderby:t("#orderby").val(),order:t("input[name=order]:checked").val(),post_type:[],tax_query:{},meta_query:{relation:"AND",0:{key:"duration_seconds",value:60*parseInt(t("#time_from").val()),compare:">=",type:"NUMERIC"},1:{key:"duration_seconds",value:60*o,compare:"<=",type:"NUMERIC"}},posts_per_page:d(),offset:c};o==parseInt(t("#time_slider").attr("max"))&&(delete i.meta_query.relation,delete i.meta_query[1]);const h={},u={};t(".type-box input:checked").each((function(){h[t(this).attr("name")]=!0,u[t(this).attr("taxonomy")]=[],i.post_type.push(t(this).attr("name"))}));t('.cat-wrap input[enabled="true"]:checked').each((function(){const e=t(this).data("object");t.each(e,((t,e)=>{h[t]&&u[e.taxonomy].push(e.slug)}))})),Object.keys(u).length>1&&(i.tax_query={relation:"OR"});let m=0;t.each(u,((t,e)=>{i.tax_query[m]={taxonomy:t,field:"slug",terms:e},m++})),t.ajax({url:e.ajax,data:{query:i,action:"custom_search",nonce:t(".query-box").data("nonce")}}).done((function(e){e=JSON.parse(e.replace(/0$/,""));const s=c+1;t.each(e.posts,((e,n)=>{t(`article[index=${s+e}]`).replaceWith(t(n).attr("index",s+e))})),t(".entry.only-loader").remove(),t(".entry .entry-title").clamp({clamp:2}),function(e){const s=t(".results");if(!e)return r=null,void s.addClass("none");r=e,s.removeClass("none"),t(".got",s).text(t(".entry").length),t(".total",s).text(e)}(e.found),l=!1}))}function h(){t(".dropdown .items").slideUp(300,(()=>{t(".dropdown").addClass("closed")}))}t.fn.extend({clamp(e){this.each((function(){t(this).data("clamp")!==e&&(o(this,e),t(this).data("clamp",e))}))}});