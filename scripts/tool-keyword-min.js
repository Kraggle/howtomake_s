import{jQuery as t}from"./src/jquery-3.5.1-min.js";import{K as e,timed as s}from"./custom/K-min.js";import"./custom/jquery-visible-min.js";import a from"./custom/Paths.js";import n from"./src/codemirror-min.js";import"./src/CodeMirror/mode/htmlmixed/htmlmixed.js";import"./src/CodeMirror/addon/display/placeholder.js";import*as i from"./keywords-shared.js";import o from"./custom/SVGIcons-min.js";t((()=>{params.is_user_logged_in;const r=t(".tool-wrap"),l=t(".setting-wrap"),c=t(".results-wrap");t(".tab-wrap",r).css("grid-template-columns",`repeat(${t(".tab",r).length}, max-content)`),t(".content-wrap").on("click",".tab:not(.active)",(function(){const s=t(this).attr("tab"),a=t(this).parents(".tab-wrap");t(".active",a.parent()).removeClass("active"),t(this).add(t(`.box[box=${s}]`)).addClass("active"),"html"==s&&v.refresh(),"Result"==t(this).closest("[which]").attr("which")&&(f.active=s,t(".results-wrap .box.active .filter.input").trigger("input"),y()),e.local(`kdt${t(this).closest(".tab-box").attr("which")}Tab`,s)}));let d,p,u,h=!1;t(".textarea .handle").on("mousedown",(function(e){u=t(this).siblings("textarea"),!u.visible()&&(u=t(this).siblings(".CodeMirror")),d=u.outerHeight(),p=e.clientY+25,h=!0})),t(window).on("mousemove",(function(t){h&&u.height(d+t.clientY-p)})),t(window).on("mouseup",(function(t){h&&(h=!1,u.focus())}));const v=n.fromTextArea(t("textarea.code").get(0),{lineNumbers:!0,mode:"text/html",lineWrapping:!0}),m=e.local("kdtToolTab");m&&t(`.tool-wrap [tab=${m}]`).click(),t("input[type=url]").on("keyup",(e=>{const s=t(".button[btn=url]");13==e.which&&!s.hasClass("loading")&&s.trigger("click")}));const f={numbers:{1:"one",2:"two",3:"three",4:"four",5:"five",6:"six",7:"seven",8:"eight",9:"nine"},active:1},b={user:()=>t.getJSON(a.ajax,{action:"keywords_get_user",nonce:t("#keyword_nonce").val()},(function(t){i.convertSettings(f,t)})),get(){const e={};return t("[key]",l).each((function(){const s=t("input",this),a=t(this).attr("key");let n=[];s.length>1?s.each((function(){t(this).val()&&n.push(t(this).val())})):n="checkbox"==s.attr("type")?s.is(":checked"):s.val(),e[a]=n})),i.convertSettings(f,e),e}};b.user();const g=()=>{const s=f.active;f.active=s<f.min?f.min:s>f.max?f.max:s;const a=t(".results-wrap"),n=t(".box-wrap",a),i=t(".tab-wrap",a);t(".tab-wrap",a).css("grid-template-columns",`repeat(${f.max-(f.min-1)}, max-content)`);const r=e=>{const s=t(`.tab[tab=${e}]`,i),a=1==e?"":"s",n=f.numbers[e]||"",o=f.active==e?" active":"";return s.length?s[(o?"add":"remove")+"Class"]("active"):t("<div />",{class:"tab"+(f.active==e?" active":""),tab:e,text:`${n.firstToUpper()} Word${a}`})},l=t=>{const s=e.local("filterRadio")||"exact";return["and","or","exact"].map((e=>`<input type="radio"  name="filter-radio-${t}" id="filter_${e}_${t}" value="${e}" ${s==e?"checked":""} >\n\t\t\t\t<label class="item" for="filter_${e}_${t}">${e}</label>`)).join("")},c=e=>{const s=t(`.box[box=${e}]`,n),a=f.active==e?" active":"";return s.length?s[(a?"add":"remove")+"Class"]("active"):t("<div />",{class:`box${a}`,box:e,html:`<div class="filter-wrap">\n\t\t\t\t\t\t<label class="input-wrap" for="filter_${e}">\n\t\t\t\t\t\t\t<span class="head">Filter</span>\n\t\t\t\t\t\t\t<input id="filter_${e}" type="text" class="filter input" filter="${e}"/>\n\t\t\t\t\t\t</label>\n\t\t\t\t\t\t<div class="radio-wrap">\n\t\t\t\t\t\t\t${l(e)}\n\t\t\t\t\t\t\t<div class="selector"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="keys-table"></div>`})};for(let t=1;t<=10;t++){const e=r(t),s=c(t);t<f.min||t>f.max?(e.remove(),s.remove()):(e.appendTo(i),s.appendTo(n))}t.each(f.groups,((e,s)=>{const a=t(`[box=${e}] .keys-table`,n);a.html(`<div class="row head">\n\t\t\t\t\t<div class="head-wrap left" order="asc" sort="filter">\n\t\t\t\t\t\t<span>Keywords</span>\n\t\t\t\t\t\t<div class="icon">${o.sort}</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="head-wrap" order="asc" sort="frequency">\n\t\t\t\t\t\t<span>Frequency</span>\n\t\t\t\t\t\t<div class="icon">${o.sort}</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="head-wrap sort" order="desc" sort="density">\n\t\t\t\t\t\t<span>Density</span>\n\t\t\t\t\t\t<div class="icon">${o.sort}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="sort-table"></div>\n\t\t\t\t<div class="none">There are no results!</div>`),t.each(s,((e,s)=>{t(".sort-table",a).append(`<div class="row item show" filter="${s.keywords}" \n\t\t\t\t\t\tfrequency="${s.count}" density="${(1e4*s.density).toFixed(0)}">\n\t\t\t\t\t\t<span class="left">${s.keywords}</span>\n\t\t\t\t\t\t<span>${s.count}</span>\n\t\t\t\t\t\t<span>${s.density.toFixed(2)}%</span>\n\t\t\t\t\t</div>`)})),t(".none",a).css("display",s.length?"none":"block")})),t(".hidden").removeClass("hidden"),t(".loading").removeClass("loading"),y()};t(".box-wrap").on("click",".button:not(.loading)",(function(){const e=t(this);t(".error.url").removeClass("show"),t(this).addClass("loading");const s=t(this).attr("btn"),n=t(this).closest(`[box=${s}]`),o=t=>{f.content=t,i.getKeywords(f),g()};switch(s){case"url":t.getJSON(a.ajax,{action:"get_cross_origin",url:t("input",n).val(),nonce:t("#keyword_nonce").val()},(s=>{s.error?(t(".error.url").addClass("show").text(s.error),e.removeClass("loading")):o(s.content)}));break;case"html":o(v.getValue());break;case"text":o(t("textarea",n).val());break}})),t(".button.collapse").on("click",(function(){const e=t(this).closest(".collapse-wrap");e[(e.hasClass("active")?"remove":"add")+"Class"]("active")})),t("input[type=number][min][max]").on("blur",(function(){const s=parseInt(t(this).val()),a=parseInt(t(this).attr("min")),n=parseInt(t(this).attr("max")),i=t(this).attr("sum"),o=!!t(this).attr("other")&&parseInt(t(`#${t(this).attr("other")}`).val());if(s)if(s>n){if(i&&!e.evaluate[i](s,o))return void t(this).val(o);t(this).val(n)}else if(s<a){if(i&&!e.evaluate[i](s,o))return void t(this).val(o);t(this).val(a)}else i&&!e.evaluate[i](s,o)&&t(this).val(o);else t(this).val(t(this).attr(t(this).attr("resolve")))})),l.on("click",".button.add[add]",(function(){const e=t(this).attr("add");t(this).siblings(`[is=${e}]`).eq(0).clone().insertAfter(t(this)).find("input").val("")})),l.on("input change propertyChange","input",(function(){x(!0)})),l.on("click",".update.button:not(.active)",(function(){t(this).addClass("loading active");const e=b.get();i.getKeywords(f),g(),x(!1),t.ajax({url:a.ajax,type:"POST",data:{action:"keywords_save_user",nonce:t("#keyword_nonce").val(),data:e}})}));const w=s(),x=e=>w.run((()=>{l[(e?"add":"remove")+"Class"]("do-update"),t(".update.button",l).removeClass("active loading")}),500);l.on("click",".button.delete",(function(){const e=t(this).attr("delete"),s=t(this).closest(`[is=${e}]`);t(`[is=${e}]`,l).length>1?s.remove():t("input",s).val(""),x(!0)})),t(".button.clear",l).on("click",(()=>{const e=".collapse-wrap .input-wrap",s=t(e).eq(0).clone();t(e).remove(),s.insertAfter(t(".collapse-wrap .button.add")).find("input").val("").trigger("input")})),t(".button.default",l).on("click",(()=>{const e=".collapse-wrap .input-wrap",s=t(e).eq(0).clone();t(e).remove(),t.getJSON(a.ajax,{action:"keywords_get_default",nonce:t("#keyword_nonce").val()},(function(e){t.each(e.ignore_list,((e,a)=>{const n=s.clone();t("input",n).val(a),t(".collapse-wrap",l).append(n)})),t(".collapse-wrap .input-wrap input",l).trigger("input")}))})),c.on("input propertyChange",".filter.input",(function(){const a=t(this).data();!a.timer&&(a.timer=s()),a.timer.run((()=>{const s=t(this).val(),a=t(this).closest(".box");t(".filter.input",c).val(s),a.find("[filter]").removeClass("show"),s&&a.find(i.filter[e.local("filterRadio")||"exact"](s)).addClass("show"),!s&&a.find("[filter]").addClass("show")}),500)})),c.on("change propertyChange",".radio-wrap input",(function(){const s=t(this).val();e.local("filterRadio",s),t(`input[value=${s}]`,c).prop("checked",!0),t(".results-wrap .box.active .filter.input").trigger("input")})),c.on("click",".head-wrap",(function(){let e=t(this).attr("order");const s=t(this).attr("sort");t(this).hasClass("sort")?(e="asc"==e?"desc":"asc",t(this).attr("order",e)):(t(this).siblings(".sort").removeClass("sort"),t(this).addClass("sort"));const a=t(this).closest(".keys-table"),n=a.find(".row.item").sort(((a,n)=>{let i=t(a).attr(s),o=t(n).attr(s);const r="asc"==e?-1:1,l="asc"==e?1:-1;return isNaN(i)||(i=parseInt(i),o=parseInt(o)),i<o?r:i>o?l:0}));t(".sort-table",a).html(n)}));const y=()=>{const e=t(".content .wrapper").outerWidth(),s=t(".tab",c);let a=10;if(s.each((function(e){const s=t(this).outerWidth()+11;a+=s})),e<a){const t=(a-e)/(s.length-1);s.css("margin-left",`-${t}px`).addClass("blend")}else s.css("margin-left",0).removeClass("blend")}})),t.expr.pseudos.regex=t.expr.createPseudo((function(e){return function(s){const a=e.split(","),n=/^(data|css):/,i={method:a[0].match(n)?a[0].split(":")[0]:"attr",property:a.shift().replace(n,"")};return new RegExp(a.join("").replace(/^\s+|\s+$/g,""),"ig").test(t(s)[i.method](i.property))}}));