import{jQuery as t}from"./src/jquery-3.5.1-min.js";import{K as e,timed as s}from"./custom/K-min.js";import"./custom/jquery-visible-min.js";import a from"./custom/Paths.js";import i from"./src/codemirror-min.js";import"./src/CodeMirror/mode/htmlmixed/htmlmixed.js";import"./src/CodeMirror/addon/display/placeholder.js";import*as n from"./keywords-shared.js";import o from"./custom/SVGIcons-min.js";t((()=>{const r=!!params.is_user_logged_in,l=t(".tool-wrap"),c=t(".setting-wrap"),d=t(".results-wrap");t(".tab-wrap",l).css("grid-template-columns",`repeat(${t(".tab",l).length}, max-content)`),t(".content-wrap").on("click",".tab:not(.active)",(function(){const s=t(this).attr("tab"),a=t(this).parents(".tab-wrap");t(".active",a.parent()).removeClass("active"),t(this).add(t(`.box[box=${s}]`)).addClass("active"),"html"==s&&m.refresh(),"Result"==t(this).closest("[which]").attr("which")&&(b.active=s,t(".results-wrap .box.active .filter.input").trigger("input")),e.local(`kdt${t(this).closest(".tab-box").attr("which")}Tab`,s)}));let p,h,u,v=!1;t(".textarea .handle").on("mousedown",(function(e){u=t(this).siblings("textarea"),!u.visible()&&(u=t(this).siblings(".CodeMirror")),p=u.outerHeight(),h=e.clientY+25,v=!0})),t(window).on("mousemove",(function(t){v&&u.height(p+t.clientY-h)})),t(window).on("mouseup",(function(t){v&&(v=!1,u.focus())}));const m=i.fromTextArea(t("textarea.code").get(0),{lineNumbers:!0,mode:"text/html",lineWrapping:!0}),f=e.local("kdtToolTab");f&&t(`.tool-wrap [tab=${f}]`).click(),t("input[type=url]").on("keyup",(e=>{const s=t(".button[btn=url]");13==e.which&&!s.hasClass("loading")&&s.trigger("click")}));const b={numbers:{1:"one",2:"two",3:"three",4:"four",5:"five",6:"six",7:"seven",8:"eight",9:"nine"},active:1},g={defaults:n.getSettings,get(){const e={};t("[key]",c).each((function(){const s=t("input",this),a=t(this).attr("key");let i=[];s.length>1?s.each((function(){t(this).val()&&i.push(t(this).val())})):i="checkbox"==s.attr("type")?s.is(":checked"):s.val(),e[a]=i})),n.convertSettings(b,e)}};g.defaults(b);const w=()=>{const s=b.active;b.active=s<b.min?b.min:s>b.max?b.max:s;const a=t(".results-wrap"),i=t(".box-wrap",a),n=t(".tab-wrap",a);t(".tab-wrap",a).css("grid-template-columns",`repeat(${b.max-(b.min-1)}, max-content)`);const r=e=>{const s=t(`.tab[tab=${e}]`,n),a=1==e?"":"s",i=b.numbers[e]||"",o=b.active==e?" active":"";return s.length?s[(o?"add":"remove")+"Class"]("active"):t("<div />",{class:"tab"+(b.active==e?" active":""),tab:e,text:`${i.firstToUpper()} Word${a}`})},l=t=>{const s=e.local("filterRadio")||"exact";return["and","or","exact"].map((e=>`<input type="radio"  name="filter-radio-${t}" id="filter_${e}_${t}" value="${e}" ${s==e?"checked":""} >\n\t\t\t\t<label class="item" for="filter_${e}_${t}">${e}</label>`)).join("")},c=e=>{const s=t(`.box[box=${e}]`,i),a=b.active==e?" active":"";return s.length?s[(a?"add":"remove")+"Class"]("active"):t("<div />",{class:`box${a}`,box:e,html:`<div class="filter-wrap">\n\t\t\t\t\t\t<label class="input-wrap" for="filter_${e}">\n\t\t\t\t\t\t\t<span class="head">Filter</span>\n\t\t\t\t\t\t\t<input id="filter_${e}" type="text" class="filter input" filter="${e}"/>\n\t\t\t\t\t\t</label>\n\t\t\t\t\t\t<div class="radio-wrap">\n\t\t\t\t\t\t\t${l(e)}\n\t\t\t\t\t\t\t<div class="selector"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="keys-table"></div>`})};for(let t=1;t<=10;t++){const e=r(t),s=c(t);t<b.min||t>b.max?(e.remove(),s.remove()):(e.appendTo(n),s.appendTo(i))}t.each(b.groups,((e,s)=>{const a=t(`[box=${e}] .keys-table`,i);a.html(`<div class="row head">\n\t\t\t\t\t<div class="head-wrap left" order="asc" sort="filter">\n\t\t\t\t\t\t<span>Keywords</span>\n\t\t\t\t\t\t<div class="icon">${o.sort}</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="head-wrap" order="asc" sort="frequency">\n\t\t\t\t\t\t<span>Frequency</span>\n\t\t\t\t\t\t<div class="icon">${o.sort}</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="head-wrap sort" order="desc" sort="density">\n\t\t\t\t\t\t<span>Density</span>\n\t\t\t\t\t\t<div class="icon">${o.sort}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="sort-table"></div>\n\t\t\t\t<div class="none">There are no results!</div>`),t.each(s,((e,s)=>{t(".sort-table",a).append(`<div class="row item show" filter="${s.keywords}" \n\t\t\t\t\t\tfrequency="${s.count}" density="${(1e4*s.density).toFixed(0)}">\n\t\t\t\t\t\t<span class="left">${s.keywords}</span>\n\t\t\t\t\t\t<span>${s.count}</span>\n\t\t\t\t\t\t<span>${s.density.toFixed(2)}%</span>\n\t\t\t\t\t</div>`)})),t(".none",a).css("display",s.length?"none":"block")})),t(".hidden").removeClass("hidden"),t(".loading").removeClass("loading")};t(".box-wrap").on("click",".button:not(.loading)",(function(){const e=t(this);t(".error.url").removeClass("show"),t(this).addClass("loading");const s=t(this).attr("btn"),i=t(this).closest(`[box=${s}]`),o=t=>{b.content=t,n.getKeywords(b),w()};switch(s){case"url":t.getJSON(a.ajax,{action:"get_cross_origin",url:t("input",i).val(),nonce:t("#keyword_nonce").val()},(s=>{s.error?(t(".error.url").addClass("show").text(s.error),e.removeClass("loading")):o(s.content)}));break;case"html":o(m.getValue());break;case"text":o(t("textarea",i).val());break}})),t(".button.collapse").on("click",(function(){const e=t(this).closest(".collapse-wrap");e[(e.hasClass("active")?"remove":"add")+"Class"]("active")})),t("input[type=number][min][max]").on("blur",(function(){const s=parseInt(t(this).val()),a=parseInt(t(this).attr("min")),i=parseInt(t(this).attr("max")),n=t(this).attr("sum"),o=!!t(this).attr("other")&&parseInt(t(`#${t(this).attr("other")}`).val());if(s)if(s>i){if(n&&!e.evaluate[n](s,o))return void t(this).val(o);t(this).val(i)}else if(s<a){if(n&&!e.evaluate[n](s,o))return void t(this).val(o);t(this).val(a)}else n&&!e.evaluate[n](s,o)&&t(this).val(o);else t(this).val(t(this).attr(t(this).attr("resolve")))})),c.on("click",".button.add[add]",(function(){const e=t(this).attr("add");t(this).siblings(`[is=${e}]`).eq(0).clone().insertBefore(t(this)).find("input").val("")})),c.on("input change propertyChange","input",(function(){$(r)})),t(".update.button",c).on("click",(function(){t(".update.button",c).addClass("active"),g.get(),n.getKeywords(b),w(),$(!1)}));const x=s(),$=e=>x.run((()=>{c[(e?"add":"remove")+"Class"]("do-update"),t(".update.button",c).removeClass("active")}),1e3);c.on("click",".button.delete",(function(){const e=t(this).attr("delete"),s=t(this).closest(`[is=${e}]`);t(`[is=${e}]`,c).length>1?s.remove():t("input",s).val(""),$(!0)})),d.on("input propertyChange",".filter.input",(function(){const a=t(this).data();!a.timer&&(a.timer=s()),a.timer.run((()=>{const s=t(this).val(),a=t(this).closest(".box");t(".filter.input",d).val(s),a.find("[filter]").removeClass("show"),s&&a.find(n.filter[e.local("filterRadio")||"exact"](s)).addClass("show"),!s&&a.find("[filter]").addClass("show")}),500)})),d.on("change propertyChange",".radio-wrap input",(function(){const s=t(this).val();e.local("filterRadio",s),t(`input[value=${s}]`,d).prop("checked",!0),t(".results-wrap .box.active .filter.input").trigger("input")})),d.on("click",".head-wrap",(function(){let e=t(this).attr("order");const s=t(this).attr("sort");t(this).hasClass("sort")?(e="asc"==e?"desc":"asc",t(this).attr("order",e)):(t(this).siblings(".sort").removeClass("sort"),t(this).addClass("sort"));const a=t(this).closest(".keys-table"),i=a.find(".row.item").sort(((a,i)=>{let n=t(a).attr(s),o=t(i).attr(s);const r="asc"==e?-1:1,l="asc"==e?1:-1;return isNaN(n)||(n=parseInt(n),o=parseInt(o)),n<o?r:n>o?l:0}));t(".sort-table",a).html(i)}))})),t.expr.pseudos.regex=t.expr.createPseudo((function(e){return function(s){const a=e.split(","),i=/^(data|css):/,n={method:a[0].match(i)?a[0].split(":")[0]:"attr",property:a.shift().replace(i,"")};return new RegExp(a.join("").replace(/^\s+|\s+$/g,""),"ig").test(t(s)[n.method](n.property))}}));