import{jQuery as e}from"./jquery-3.5.1-min.js";const t={pluginName:"imgColor",canvas:document.createElement("canvas"),SIDE_TOP:"t",SIDE_RIGHT:"r",SIDE_BOTTOM:"b",SIDE_LEFT:"l",dfdCache:{},getDfd(t){let o=this.dfdCache[t];return o||(o=e.Deferred(),this.dfdCache[t]=o),o},decToHex(e){const t=e.toString(16);return 1===t.length?"0"+t:t},rgbToHex:(e,t,o)=>["#",decToHex(e),decToHex(t),decToHex(o)].join(""),count(e,t,o){if(t[e+3]<127)return;const r=rgbToHex(t[e],t[e+1],t[e+2]);o[r]?o[r]++:o[r]=1},traverse(e,t,o,r,n){let i,s;if(e===this.SIDE_TOP||e===this.SIDE_BOTTOM)for(s=e===this.SIDE_TOP?0:r-1,i=0;i<o;i++)this.count(4*(s*o+i),n,t);else for(r-=1,i=e===this.SIDE_RIGHT?o-1:0,s=1;s<r;s++)this.count(4*(s*o+i),n,t)},computeByImage(e,t){let o,r,n,i="#ffffff",s=0;const c={},a=e.width,f=e.height,h=this.canvas.getContext("2d");for(r in this.canvas.width=a,this.canvas.height=f,h.drawImage(e,0,0),o=h.getImageData(0,0,a,f).data,t.indexOf(this.SIDE_TOP)<0&&this.traverse(this.SIDE_TOP,c,a,f,o),t.indexOf(this.SIDE_RIGHT)<0&&this.traverse(this.SIDE_RIGHT,c,a,f,o),t.indexOf(this.SIDE_BOTTOM)<0&&this.traverse(this.SIDE_BOTTOM,c,a,f,o),t.indexOf(this.SIDE_LEFT)<0&&this.traverse(this.SIDE_LEFT,c,a,f,o),c)n=c[r],n>s&&(i=r,s=n);return i},compute(e,t){let o=new Image;const r={url:e,ignore:t};o.onload=()=>{try{r.color=computeByImage(this,t),this.getDfd(e).resolve(r)}catch(t){this.getDfd(e).reject(r)}o=null},o.onerror=()=>{o.onerror=null,o=null,this.getDfd(e).reject(r)},o.crossOrigin="",o.src=e},imageColor:{color(e){const o=t,r=o.getDfd(e.url);"function"==typeof e.success&&r.done(e.success),"function"==typeof e.error&&r.fail(e.error),"pending"===r.state()&&o.compute(e.url,"string"==typeof e.ignore?e.ignore:"")}}};function o(o,r,n){const i=e(o),s=i.data("imgColorIgnore");"object"==typeof r&&(n=r,r=void 0),n=e.extend({url:o.src},n),"string"==typeof s&&(n.ignore=s),n.success=function(t){var n="function"==typeof r?r.call(o,o,t.color):"string"==typeof r?e(r):i.parent();n&&n.jquery&&n.css("backgroundColor",t.color)},t.imageColor.color(n)}e.fn[t.pluginName]=function(e,t){return this.each((function(){new o(this,e,t)}))};