import{jQuery as t}from"./src/jquery-3.5.1-min.js";import e from"./custom/Paths.js";import{K as s,timed as n}from"./custom/K-min.js";import"./src/jQuery-UI/jq-ui-core-min.js";import"./src/jQuery-UI/modules/jq-ui-autocomplete-min.js";function a(e,s){const n=100*(e-s)/e;t(".ks-progress-back").css("width",`${n}%`),t(".ks-progress-number").text(n?n.toFixed(2)+"%":"")}function i(s){const n=arguments;let a={},i=function(){};"object"==typeof n[1]?(a=n[1],"function"==typeof n[2]&&(i=n[2])):"function"==typeof n[1]&&(i=n[1]),t.ajax({url:e.ajax,type:"POST",data:{action:s,nonce:t(".ks-box").data("nonce"),data:a}}).done((e=>{(e=JSON.parse(e.replace(/0$/,""))).message&&t.each(e.message,((t,e)=>{setTimeout((()=>{o.add(e)}),250*t)})),i(e)}))}t((()=>{l.build(t(".ks-progress-time")),o.build(t(".ks-feed-text")),t(".ks-button[count]").addClass("doMe"),t(".ks-button").on("click",(function(){const e=t(this).attr("count"),s=t(this).attr("action"),n=t(this).attr("other");if(t(this).attr("type")){if(!t(this).hasClass("doMe"))return;const e={};t(this).parents(".ks-setting-box").find("input").each((function(){e[t(this).attr("name")]=t(this).is(":checked")})),i(s,{inputs:e},(e=>{if(e.success&&(t(this).removeClass("doMe"),e.action&&e.ids&&e.ids.length)){const s=e.ids.length,o=()=>{if(l.start(),!e.ids.length)return t(this).removeClass("doMe"),t(`#${n}`).addClass("doMe"),a(10,10),void l.reset();i(e.action,{ids:e.ids.splice(0,e.loop)},(t=>{t.success&&(a(s,e.ids.length),l.left(e.ids.length,e.loop).end(),o())}))};o()}}))}else if(e)i(s,(s=>{t(`#${e}`).val(s.count),s.count>0&&(t(this).removeClass("doMe"),t(`#${n}`).addClass("doMe")),s.ids&&t(`#${n}`).data("ids",s.ids),s.data&&t(`#${n}`).data("data",s.data)}));else{if(!t(this).hasClass("doMe"))return;const e=parseInt(t(this).attr("repeat")||0),o=t(this).data("ids"),d=t(this).data("data"),r=t(this).attr("doDouble");let c=o.length,h=t(this).attr("get");if(h&&t(this).parents(".ks-setting-box").find(h).each((function(){"array"!=t.type(h)&&(h=[]),t(this).is(":checked")&&h.push(t(this).attr("name").replace(/^_/,""))})),e&&o.length){const u=o.length,m=()=>{if(l.start(),!o.length)return t(this).removeClass("doMe"),t(`#${n}`).addClass("doMe"),a(10,10),void l.reset();i(s,{ids:o.splice(0,e),data:d,get:h},(s=>{s.success?(r||(t(`#${t(`#${n}`).attr("count")}`).val(o.length),a(u,o.length),l.left(o.length,e).end()),m()):s.double&&p(s)}))},p=e=>{l.start(),e.action&&e.ids&&e.ids.length?i(e.action,{ids:e.ids.splice(0,e.loop),data:d,get:h},(s=>{s.success&&(c-=e.loop,t(`#${t(`#${n}`).attr("count")}`).val(c),a(u,c),l.left(c,e.loop).end(),p(e))})):m()};m()}else i(s,(e=>{e.success&&(t(this).hasClass("red")||(t(this).removeClass("doMe"),t(`#${n}`).addClass("doMe")),t(`#${t(`#${n}`).attr("count")}`).val(e.count))}))}})),t('input[type="checkbox"').on("change",(function(){t(this).parents(".ks-setting-box").find(".ks-button").addClass("doMe")})),setInterval((()=>{t(".edit").closest(".acf-input").each((function(){const s=t(this);t(".edit",s).length>1&&t(".edit",s).last().remove();const n=t("> .edit, > .select2",s);2===n.length&&(n.wrapAll('<div class="with-edit-wrap"></div>'),t(".edit",s).on("click",(function(n){n.preventDefault();const a=t("select option[selected=selected]",s).val();a&&t.ajax({url:e.ajax,type:"POST",data:{action:"get_edit_link",nonce:t(".admin-page-nonce").attr("nonce"),id:a}}).done((t=>{if((t=JSON.parse(t)).link){window.open(t.link,"_blank").focus()}}))})))}))}),2e3);const d={el:t('div[data-name="toc"]'),list:[],changed:!1,timed:n(),text:{content:null},visual:{content:null},on:!0,update(e){d.timed.run((()=>{e||(e=t("textarea#content")),d.on=!!e.level;const n=d.on?"visual":"text",a=d.on?e.level.content:t(e.target?e.target:e).val();if(a!==d[n].content){d[n].content=a;const e=[];t("<div />",{html:a}).find('[id][id!=""]').each((function(){e.push(t(this).attr("id"))})),s.equals(d.list,e)||(d.list=e,d.changed=!0,d.autoComplete())}}),2e3)},autoComplete(){const e=t('td[data-name="id"] input',d.el);e.autocomplete({source:d.list});const s="input change keyup click propertyChange";e.off(s).on(s,d.ifError),e.each(d.ifError)},ifError(){const e=t(this).val();if(d.changed||t(this).data("value")!==e){d.changed=!1;const n=t(this).closest(".acf-table").find("[data-name=link] select"),a="- Select -"!==t(":selected",n).text();n.data("timer")&&clearInterval(n.data("timer")),n.data("timer",setInterval((()=>{n.data("value")!==t(":selected",n).text()&&(n.data("value",t(":selected",n).text()),t(this).trigger("change"),d.changed=!0)}),2e3)),t(this).data("value",e),t(this)[(s.isInArray(e,d.list)||!e||a?"remove":"add")+"Class"]("error")}}};if(d.el.length){t("#post-body-content").on("input propertyChange","textarea#content",d.update);const e=setInterval((()=>{tinyMCE.editors.length&&"content"===tinyMCE.editors[0].id&&(tinyMCE.editors[0].on("change",d.update),clearInterval(e))}),2e3);d.update(),d.el.on("click","a[data-event=add-row]",d.autoComplete)}}));const o={element:null,count:0,build(t){this.element=t},clear(){t(this.element).length&&t(this.element).html("")},add(e){if(!t(this.element).length)return;this.count++,t(this.element).append(`<p>${e}</p>`);const s=t(this.element).outerHeight(!0);s>84&&t(this.element).css("top",`-${s-84}px`)}},l={startTime:null,endTime:null,average:[],element:null,remain:0,loop:0,build(t){return this.element=t,this},reset(){return this.average=[],t(this.element).html(""),this},start(){return this.startTime=new Date,this},end(){return this.endTime=new Date,this.average.push(this.endTime-this.startTime),this.update(),this},update(){if(!this.element||this.average.length<3)return;const e=(this.average.reduce(((t,e)=>t+e),0)/this.average.length||0)*(this.remain/this.loop);t(this.element).html(this.time(e))},time(t){let e=(t/1e3).toFixed(0),s=Math.floor(e/60),n="";s>59&&(n=Math.floor(s/60),s-=60*n),e=Math.floor(e%60);let a=n?`${n} hours`:"";return s&&e?a+=` ${s} minutes and ${e} seconds`:n&&e?a+=` and ${e} seconds`:n&&s?a+=` and ${s} minutes`:s?a+=`${s} minutes`:e&&(a+=`${e} seconds`),a+=" estimated",a},left(t,e){return this.remain=t,this.loop=e,this}};